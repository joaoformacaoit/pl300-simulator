<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PL-300 Exam Simulator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* --- Base Layout & Fonts --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f6f9;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }
        .container {
            width: 100%;
            max-width: 800px;
            background-color: #ffffff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease-in-out;
        }

        /* --- Header & Progress Bar --- */
        .header {
            background-color: #ffffff;
            color: #333;
            padding: 15px 25px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h2 {
            margin: 0;
            font-size: 1.2em;
            font-weight: 600;
        }
        .progress-bar-container {
            width: 100%;
            height: 6px;
            background-color: #e0e0e0;
        }
        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: #0078d4;
            transition: width 0.3s ease;
        }
        .question-counter {
            font-weight: bold;
            font-size: 0.9em;
            color: #666;
        }

        /* --- Content Area (Questions/Results) --- */
        .content {
            padding: 30px;
            min-height: 350px;
        }
        .question-text {
            font-size: 1.4em;
            font-weight: 500;
            margin-bottom: 25px; 
            line-height: 1.4;
        }
        
        /* --- Options List --- */
        .options-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .option-item {
            background-color: #f7f9fc;
            border: 1px solid #e0e6ed;
            border-radius: 6px;
            margin-bottom: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .option-item:hover {
            background-color: #eaf1f7;
            border-color: #0078d4;
        }
        .option-item input[type="radio"],
        .option-item input[type="checkbox"] {
            margin-right: 15px;
            transform: scale(1.2);
        }
        .option-item label {
            display: block;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 400;
            user-select: none;
        }

        /* --- Footer & Navigation --- */
        .footer {
            padding: 15px 25px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #prev-btn {
            background-color: #f0f2f5;
            color: #333;
        }
        #prev-btn:hover {
            background-color: #e0e2e5;
        }
        #next-btn, #finish-btn {
            background-color: #0078d4;
            color: white;
            margin-left: 10px;
        }
        #next-btn:hover, #finish-btn:hover {
            background-color: #005a9e;
        }
        #finish-btn {
            background-color: #107c10;
        }
        #finish-btn:hover {
            background-color: #0c6a0c;
        }

        /* --- Question Pager (1, 2, 3...) --- */
        .pager {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .pager-item {
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            background-color: #e0e0e0;
            color: #333;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s;
        }
        .pager-item.active {
            background-color: #0078d4;
            color: white;
            font-weight: bold;
        }
        .pager-item.answered {
            background-color: #d1e7dd;
        }
        .pager-item.active.answered {
            background-color: #0078d4;
        }

        /* --- Results/Feedback --- */
        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            font-size: 1.1em;
            display: none;
        }
        .feedback.correct {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .feedback.incorrect {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6fb;
        }
        .explanation {
            margin-top: 10px;
            font-size: 0.95em;
            font-style: italic;
        }
        .topic-level {
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 10px;
        }

        /* --- Welcome/Start Screen --- */
        #start-screen {
            text-align: center;
            padding: 50px 30px;
        }
        #start-screen h1 {
            font-size: 2em;
            color: #0078d4;
            margin-bottom: 5px;
        }
        #start-screen p {
            color: #6c757d;
            margin-bottom: 30px;
        }
        .info-list {
            list-style: none;
            padding: 0;
            margin: 30px 0;
            text-align: left;
            display: inline-block;
        }
        .info-list li {
            font-size: 1.1em;
            margin-bottom: 15px;
            color: #333;
        }
        .info-list i {
            color: #107c10;
            margin-right: 10px;
        }
        #start-btn {
            padding: 15px 40px;
            font-size: 1.2em;
            background-color: #0078d4;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #start-btn:hover {
            background-color: #005a9e;
        }

        /* --- Final Results Screen --- */
        #final-results-screen {
            text-align: center;
            padding: 50px 30px;
        }
        #final-results-screen h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
        }
        #final-results-screen .score-summary {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        .score-box {
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            width: 150px;
        }
        .score-box h3 {
            font-size: 2em;
            margin: 0 0 5px 0;
        }
        .score-box p {
            margin: 0;
            font-weight: 500;
        }
        .score-box.correct { background-color: #d1e7dd; color: #0f5132; }
        .score-box.incorrect { background-color: #f8d7da; color: #842029; }
        .score-box.total { background-color: #cce5ff; color: #004085; }
        
        .review-toggle-btn {
            padding: 12px 30px;
            margin-top: 20px;
            background-color: #0078d4;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .review-toggle-btn:hover {
             background-color: #005a9e;
        }

        /* CSS to hide the review list by default */
        #review-container {
            display: none;
            margin-top: 30px;
        }

        .result-review-item {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 20px;
            padding: 15px;
            text-align: left;
            position: relative;
        }
        .result-review-item.correct-answer { background-color: #e9f5e9; }
        .result-review-item.incorrect-answer { background-color: #fcebeb; }
        .review-q-text { font-weight: bold; margin-bottom: 5px; }
        .review-explanation { font-style: italic; font-size: 0.9em; margin-top: 10px; border-top: 1px dashed #ccc; padding-top: 10px;}
        .review-status-icon {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5em;
        }
        .review-status-icon.correct { color: #107c10; }
        .review-status-icon.incorrect { color: #dc3545; }


    </style>
</head>
<body>

    <div class="container">
        <div class="header" id="quiz-header" style="display: none;">
            <h2 id="exam-title">PL-300 Exam</h2>
            <div class="question-counter" id="question-counter">Question 1 of 30</div>
        </div>
        <div class="progress-bar-container" id="progress-container" style="display: none;">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <div class="content">
            <div id="start-screen">
                <i class="fas fa-check-circle" style="font-size: 4em; color: #0078d4; margin-bottom: 20px;"></i>
                <h1>PL-300 Exam Simulator</h1>
                <p>Microsoft Power BI Data Analyst</p>
                
                <h2>Exam Information:</h2>
                <ul class="info-list" id="start-info-list">
                    </ul>
                
                <button id="start-btn">Start Exam</button>
            </div>

            <div id="quiz-screen" style="display: none;">
                <div id="question-text" class="question-text"></div>
                <ul class="options-list" id="options-list"></ul>
                <div class="feedback" id="feedback-message"></div>
                
                <div style="text-align: right; margin-top: 10px;">
                    <i id="flag-icon" class="fas fa-flag" style="color: #6c757d; cursor: pointer;" title="Flag for Review"></i>
                </div>
            </div>

            <div id="final-results-screen" style="display: none;">
                <h2 id="pass-fail-status">Not Passed</h2>
                <p id="final-score-text">Final Score: 10%</p>
                <div class="score-summary">
                    <div class="score-box correct">
                        <h3 id="correct-count">0</h3>
                        <p>Correct</p>
                    </div>
                    <div class="score-box incorrect">
                        <h3 id="incorrect-count">30</h3>
                        <p>Incorrect</p>
                    </div>
                    <div class="score-box total">
                        <h3 id="total-count">30</h3>
                        <p>Total</p>
                    </div>
                </div>
                
                <button class="review-toggle-btn" id="review-toggle-btn">
                    <i class="fas fa-eye"></i> Show Answer Review
                </button>
                
                <div id="review-container">
                    <h3>Answer Review:</h3>
                    <div id="review-list">
                        </div>
                </div>
            </div>
            
        </div>

        <div class="footer" id="quiz-footer" style="display: none;">
            <div class="nav-buttons">
                <button id="prev-btn" style="display: none;"><i class="fas fa-arrow-left"></i> Previous</button>
            </div>
            <div class="pager" id="pager-container">
                </div>
            <div class="nav-buttons">
                <button id="next-btn">Next <i class="fas fa-arrow-right"></i></button>
                <button id="finish-btn" style="display: none;"><i class="fas fa-check-circle"></i> Finish Exam</button>
            </div>
        </div>

    </div>

    <script>
        /**
         * Converts Markdown bold syntax (**text**) to HTML strong tags (<strong>text</strong>).
         * @param {string} text - The input string with Markdown.
         * @returns {string} The output string with HTML strong tags.
         */
        function markdownToHtmlBold(text) {
            // This replaces **text** with <strong>text</strong>
            return text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        }

        // FIX 1: Extract the scenario description to a stable constant
        const YN_SCENARIO_DESCRIPTION = "You need to minimize the size and memory usage of a large data model.";

        const quizQuestions = [
            // --- 5 EASY QUESTIONS (ID 1-5) ---
            {
                id: 1,
                topic: "Visualization",
                level: "Easy",
                question: "Which type of visualization should you use to clearly display the **contribution of each part to a whole** (e.g., product categories by total sales)?",
                options: [
                    "Line Chart",
                    "Scatter Plot",
                    "100% Stacked Column Chart",
                    "Table"
                ],
                correctAnswers: [2],
                explanation: "The **100% Stacked Column Chart** (or Stacked Bar Chart) is the standard visual for showing the proportional contribution of segments within categories."
            },
            {
                id: 2,
                topic: "Data Preparation",
                level: "Easy",
                question: "Which editor is used within Power BI Desktop to perform Extract, Transform, and Load (ETL) operations?",
                options: [
                    "DAX Studio",
                    "Power Query Editor",
                    "M Code Editor",
                    "Report View"
                ],
                correctAnswers: [1],
                explanation: "The **Power Query Editor** is the dedicated tool within Power BI for connecting to data sources and performing data transformation steps."
            },
            {
                id: 3,
                topic: "Data Modeling",
                level: "Easy",
                question: "In the relationship view, what is the most common cardinality (type) between a single customer in a Dimension table and their transactions in a Fact table?",
                options: [
                    "Many-to-Many",
                    "One-to-One",
                    "One-to-Many",
                    "Many-to-One"
                ],
                correctAnswers: [2],
                explanation: "The standard cardinality is **One-to-Many (1:*)**, where the Dimension table is the 'One' side and the Fact table is the 'Many' side."
            },
            {
                id: 4,
                topic: "DAX",
                level: "Easy",
                question: "When creating a visual that needs to display **sales for the last 30 days**, should you create a Calculated Column or a Measure?",
                options: [
                    "Calculated Column",
                    "Measure",
                    "Custom Column (Power Query)",
                    "Data Grouping"
                ],
                correctAnswers: [1],
                explanation: "A **Measure** is required because the result must dynamically change based on the current date, filters, and time context."
            },
            {
                id: 5,
                topic: "Deployment",
                level: "Easy",
                question: "To share reports and collaborate with a team in the Power BI Service, you must publish the content to a:",
                options: [
                    "Dashboard",
                    "App",
                    "Workspace",
                    "Dataflow"
                ],
                correctAnswers: [2],
                explanation: "A **Workspace** serves as the container for collaboration and management of reports, datasets, and dashboards for a specific team or project."
            },
            
            // --- 10 INTERMEDIATE QUESTIONS (ID 6-15) ---
            {
                id: 6,
                topic: "Data Preparation",
                level: "Intermediate",
                question: "Which Power Query transformation is used to combine the data from two different tables that have the same column structure but different rows (e.g., Sales 2024 and Sales 2025)?",
                options: [
                    "Merge Queries",
                    "Append Queries",
                    "Group By",
                    "Pivot Column"
                ],
                correctAnswers: [1],
                explanation: "**Append Queries** is used to stack rows of multiple tables together when they share the same schema."
            },
            {
                id: 7,
                topic: "Data Modeling",
                level: "Intermediate",
                question: "Why should you **hide** the primary key columns (e.g., CustomerKey) in the Dimension tables from the Report View?",
                options: [
                    "To save memory in the model.",
                    "To prevent end-users from mistakenly using them in visuals and filters.",
                    "Hiding them prevents the relationship from being active.",
                    "They are automatically hidden if RLS is applied."
                ],
                correctAnswers: [1],
                explanation: "Hiding key columns prevents end-users from dragging them onto visuals, as they serve a technical purpose (relationships) and rarely provide meaningful information to users."
            },
            {
                id: 8,
                topic: "DAX",
                level: "Intermediate",
                question: "You need to calculate the **Gross Margin** (`Gross Profit / Sales Amount`). Should you use the `/` operator or the `DIVIDE` function in DAX, and why?",
                options: [
                    "`/` because it is faster to execute.",
                    "`DIVIDE` because it handles division by zero error gracefully.",
                    "`/` because `DIVIDE` is an M function.",
                    "`DIVIDE` because it supports multi-threading better."
                ],
                correctAnswers: [1],
                explanation: "The **DIVIDE** function (index 1) is preferred because it safely handles division by zero by allowing an optional result (e.g., BLANK or 0) instead of returning an error."
            },
            {
                id: 9,
                topic: "Visualization",
                level: "Intermediate",
                question: "When applying a slicer to a column in your data, which Power BI feature should you use to prevent the slicer from filtering a specific visual on the same page?",
                options: [
                    "Visual Interactions",
                    "Report Tooltips",
                    "Cross-filter Direction",
                    "Field Parameters"
                ],
                correctAnswers: [0],
                explanation: "The **Visual Interactions** setting (Format menu) allows you to define how one visual (like a slicer) affects every other visual on the page, allowing you to explicitly disable filtering on certain targets."
            },
            {
                id: 10,
                topic: "Deployment",
                level: "Intermediate",
                question: "A report published to the Power BI Service uses data sourced from an on-premises SQL Server. To enable scheduled refresh, which component is required?",
                options: [
                    "Azure Analysis Services",
                    "A VPN connection",
                    "Power BI Gateway (Standard or Personal)",
                    "A Premium Capacity license"
                ],
                correctAnswers: [2],
                explanation: "The **Power BI Gateway** acts as a secure bridge between the Power BI Service (Cloud) and data sources residing on your local network (on-premises)."
            },
            {
                id: 11,
                topic: "Data Preparation",
                level: "Intermediate",
                question: "Why might you disable the 'Enable Load' option for a staging table in Power Query?",
                options: [
                    "To ensure the table is hidden from RLS users.",
                    "To prevent the table from consuming memory in the data model.",
                    "To enforce Query Folding.",
                    "To enable the table to be used in DirectQuery mode."
                ],
                correctAnswers: [1],
                explanation: "Disabling **Enable Load** means the table is only used in Power Query as an intermediate step (staging or reference) but is not loaded into the VertiPaq engine, saving memory."
            },
            {
                id: 12,
                topic: "Data Modeling",
                level: "Intermediate",
                question: "What is the primary benefit of replacing many small dimension tables with a single, consolidated **Role-Playing Dimension** (e.g., a single Date table used for OrderDate, ShipDate, and DeliveryDate)?",
                options: [
                    "Eliminates the need for DAX time intelligence functions.",
                    "Simplifies the model schema and reduces data redundancy.",
                    "Allows all relationships to be marked as active simultaneously.",
                    "It is the only way to enable bidirectional filtering."
                ],
                correctAnswers: [1],
                explanation: "Using a single Role-Playing Dimension (like a single Date table) simplifies the model schema and ensures all date context calculations rely on a single, standardized column."
            },
            {
                id: 13,
                topic: "DAX",
                level: "Intermediate",
                question: "To count the number of **unique** customers who placed orders, which DAX function should you use?",
                options: [
                    "COUNT('Sales'[CustomerID])",
                    "COUNTROWS('Customer')",
                    "DISTINCTCOUNT('Sales'[CustomerID])",
                    "SUMX('Sales', 1)"
                ],
                correctAnswers: [2],
                explanation: "**DISTINCTCOUNT** is specifically designed to count the number of unique, non-blank values in a column, which is necessary for counting unique customers or products."
            },
            {
                id: 14,
                topic: "Deployment",
                level: "Intermediate",
                question: "When publishing a report, which Power BI license type allows users to view the report and interact with it without needing a Power BI Pro license themselves, provided the workspace is assigned to it?",
                options: [
                    "Power BI Desktop License",
                    "Power BI Free License",
                    "Power BI Premium Capacity License",
                    "Trial License"
                ],
                correctAnswers: [2],
                explanation: "A **Power BI Premium Capacity License** allows free or Pro users to consume content in the assigned workspace without requiring a separate Pro license, a key concept in scaling deployment."
            },
            {
                id: 15,
                topic: "Visualization",
                level: "Intermediate",
                question: "Which of the following visuals is **best suited** for showing trends over time when you have a continuous date axis (e.g., Daily Sales)?",
                options: [
                    "Bar Chart",
                    "Pie Chart",
                    "Line Chart",
                    "Gauge"
                ],
                correctAnswers: [2],
                explanation: "The **Line Chart** is the most effective visual for displaying continuous data and trends over a time series."
            },
            
            // --- 5 YES/NO QUESTIONS CONVERTED TO STANDARD MULTIPLE CHOICE (ID 16-20) ---
            
            // Question 16: Data Modeling / Performance (Intermediate) - Formerly Y/N Scenario 1
            {
                id: 16,
                topic: "Data Modeling / Performance",
                level: "Intermediate",
                question: "Which action has the **most significant impact** on minimizing the size and memory footprint of a large Power BI data model?",
                options: [
                    "Using only Integer columns for numerical values.",
                    "Removing columns that are not used for measures, filtering, or visuals.",
                    "Applying column compression in the Power Query Editor.",
                    "Creating a single Measure table for all DAX formulas."
                ],
                correctAnswers: [1],
                explanation: "The single most effective action to reduce model size is removing **unnecessary columns** (index 1) in Power Query, as every column consumes memory in the VertiPaq engine, regardless of its usage."
            },
            // Question 17: Data Modeling / Performance (Intermediate) - Formerly Y/N Scenario 2
            {
                id: 17,
                topic: "Data Modeling / Performance",
                level: "Intermediate",
                question: "If you have a Fact table with date keys (OrderDateKey, ShipDateKey), what is the best practice to allow filtering by multiple date types in the Report View?",
                options: [
                    "Duplicate the Fact table in Power Query for each date type.",
                    "Create multiple inactive relationships between the Fact table and a single **Role-Playing Dimension** (Date table).",
                    "Use a Calculated Column in the Fact table to convert the date key to the date format.",
                    "Convert the Fact table connectivity mode to DirectQuery."
                ],
                correctAnswers: [1],
                explanation: "The standard solution is to use a single **Role-Playing Dimension** (Date table) with **multiple inactive relationships** (index 1), activating them via the `USERELATIONSHIP` DAX function when needed."
            },
            // Question 18: Deployment / Refresh (Intermediate) - Formerly Y/N Scenario 3
            {
                id: 18,
                topic: "Deployment / Refresh",
                level: "Intermediate",
                question: "Which of the following is required to ensure RLS (Row-Level Security) filters are applied when users view a published Power BI report in the Service?",
                options: [
                    "The report must be shared via a SharePoint site.",
                    "The users must be explicitly assigned to the RLS roles within the **Power BI Service** security settings.",
                    "The RLS roles must be defined using the M language.",
                    "The data source must be using DirectQuery connectivity."
                ],
                correctAnswers: [1],
                explanation: "While RLS roles are *defined* in Power BI Desktop, they must be **assigned to users or security groups** (index 1) within the Power BI Service after publishing to become active."
            },
            // Question 19: DAX / Filtering (Intermediate) - Formerly Y/N Scenario 4
            {
                id: 19,
                topic: "DAX / Filtering",
                level: "Intermediate",
                question: "You want to create a measure that ignores all filters coming from the 'Customer' dimension table but respects all other filters (like 'Region'). Which DAX function is needed inside `CALCULATE`?",
                options: [
                    "ALLSELECTED('Customer')",
                    "ALLEXCEPT('Customer', 'Region')",
                    "REMOVEFILTERS('Customer')",
                    "USERELATIONSHIP('Customer')"
                ],
                correctAnswers: [2],
                explanation: "**REMOVEFILTERS** (which is equivalent to `ALL()`) is the primary function used to clear filtering context from a specific column or table. Using `REMOVEFILTERS('Customer')` will ignore customer filters while preserving filters on 'Region'."
            },
            // Question 20: Data Preparation (Intermediate) - Formerly Y/N Scenario 5
            {
                id: 20,
                topic: "Data Preparation / M Language",
                level: "Intermediate",
                question: "Which step in Power Query is the **least likely** to break Query Folding when applied to a SQL Server database?",
                options: [
                    "Adding an index column.",
                    "Applying a conditional column with complex nested logic.",
                    "Filtering rows based on a simple date column condition.",
                    "Using buffering functions like `Table.Buffer()`."
                ],
                correctAnswers: [2],
                explanation: "Simple actions like **filtering rows** (index 2) or renaming columns directly map to SQL (WHERE or SELECT), making them highly foldable. Complex logic, custom functions, or indexing tend to break folding."
            },
            
            // --- 10 ADVANCED QUESTIONS (ID 21-30) ---
            
            // Question 21: DAX (CALCULATETABLE) - Multi-select
            {
                id: 21,
                topic: "DAX / Filtering",
                level: "Advanced",
                question: "Which DAX functions can you use to create a **new table** containing only the top 10 customers based on total sales? (Select **TWO** answers)",
                options: [
                    "CALCULATETABLE",
                    "SUMMARIZE",
                    "RANKX",
                    "TOPN"
                ],
                correctAnswers: [0, 3], // CALCULATETABLE and TOPN
                explanation: "**TOPN** returns a table expression containing the top N rows, while **CALCULATETABLE** modifies the filter context to evaluate a table expression (as the result of TOPN)."
            },
            
            // Question 22: Data Modeling (Composite Models)
            {
                id: 22,
                topic: "Data Modeling / Connectivity",
                level: "Advanced",
                question: "A Composite Model combines data from a large DirectQuery data source with aggregated data loaded via Import mode. When a user creates a visual, under what condition will the **DirectQuery source** be hit?",
                options: [
                    "Always, as DirectQuery takes precedence.",
                    "Only when the query cannot be answered by the Import mode aggregation table.",
                    "Only when the user is an administrator.",
                    "Never, as the Import table serves as the cache."
                ],
                correctAnswers: [1], // Import aggregation precedence
                explanation: "The purpose of the Composite Model with aggregations is to hit the smaller, faster Import table whenever possible. The **DirectQuery source is only hit** when the query requires a level of detail not available in the aggregated Import table."
            },
            
            // Question 23: Deployment (RLS Testing)
            {
                id: 23,
                topic: "Deployment / Security",
                level: "Advanced",
                question: "After defining Row-Level Security (RLS) roles and publishing a report to the Power BI Service, how must you test RLS roles to ensure they work correctly for specific users?",
                options: [
                    "Test the RLS role within Power BI Desktop's Modeling tab before publishing.",
                    "Publish the report and add the specific user's email address to the security role in the Power BI Service.",
                    "Publish the report and manually filter the data by the user's name.",
                    "Set the DAX `USERNAME()` expression to return the test user's name."
                ],
                correctAnswers: [1], // Test in Desktop AND assign in Service
                explanation: "You must **test RLS roles in Power BI Desktop** first, but the final, definitive test requires publishing the report and then **assigning the user or group** to the role in the Power BI Service security settings."
            },
            
            // Question 24: DAX (Context Transition)
            {
                id: 24,
                topic: "DAX / Filtering",
                level: "Advanced",
                question: "You have a **Calculated Column** defined as `[Total Sales] = CALCULATE(SUM('Sales'[Amount]))`. When this column is used in a row context (like in a table visual), what value will it return?",
                options: [
                    "The total sales for the entire model.",
                    "The total sales for the current row's category only.",
                    "An error, as CALCULATE cannot be used in a Calculated Column.",
                    "The sum of sales for the current row."
                ],
                correctAnswers: [0], // Total Sales for the entire model
                explanation: "When `CALCULATE` is used without any filter arguments, it performs a **context transition** which converts the row context into a filter context. Since no filter is provided, it calculates the measure for the **entire data model**, often returning the grand total repeatedly."
            },
            
            // Question 25: Data Preparation (Query Parameters)
            {
                id: 25,
                topic: "Data Preparation",
                level: "Advanced",
                question: "You want to dynamically filter a large table in Power Query based on the current date, but avoid breaking Query Folding. Which approach is recommended?",
                options: [
                    "Use the Power Query UI to filter the column, which generates foldable M code.",
                    "Use a custom column with the M function `DateTime.LocalNow()` to filter the source.",
                    "Use a DAX measure with `TODAY()` to filter the visual.",
                    "Use an R or Python visual to filter the table."
                ],
                correctAnswers: [0], // Power Query UI
                explanation: "The Power Query UI is designed to generate highly efficient, **foldable M code** whenever possible for relational sources (index 0). Custom M code using non-foldable functions will break the folding."
            },
            
            // Question 26: Performance Tuning (Relationships)
            {
                id: 26,
                topic: "Performance Tuning / Data Modeling",
                level: "Advanced",
                question: "Which scenario presents the most significant **performance risk** in a data model with millions of rows?",
                options: [
                    "Using a single Date table linked to multiple Fact tables.",
                    "Setting the cross-filter direction to **Both** on a relationship to filter a large Fact table.",
                    "Using `SUM` measures instead of `SUMX` measures.",
                    "Hiding key columns from the Report View."
                ],
                correctAnswers: [1], // Bidirectional filter on large table
                explanation: "Setting the cross-filter direction to **Both** (bidirectional) on a relationship can introduce ambiguous query paths and significantly degrade performance, especially when filtering large Fact tables."
            },
            
            // Question 27: DAX (Time Intelligence) - Multi-select
            {
                id: 27,
                topic: "DAX / Time Intelligence",
                level: "Advanced",
                question: "You need to create a measure that calculates the sales difference between the current day and the same day in the previous week. Which **TWO** DAX functions are required?",
                options: [
                    "DATEADD",
                    "SAMEPERIODLASTYEAR",
                    "CALCULATE",
                    "DATESINPERIOD"
                ],
                correctAnswers: [0, 2], // DATEADD and CALCULATE
                explanation: "**CALCULATE** (index 2) is needed to change the filter context, and **DATEADD** (index 0) is used to shift the date context backward by 7 days (`DATEADD('Date'[Date], -7, DAY)`)."
            },
            
            // Question 28: Deployment (Gateways vs Dataflow)
            {
                id: 28,
                topic: "Data Preparation / Deployment",
                level: "Advanced",
                question: "You are building a reusable set of cleaned Dimension tables that will be consumed by five different Power BI reports. Where should you host and manage these common tables for efficiency and consistency?",
                options: [
                    "In a Shared folder on the local network.",
                    "In five separate Power BI Desktop files.",
                    "In a Power BI Dataflow.",
                    "As a new Calculated Table in Power BI Desktop."
                ],
                correctAnswers: [2], // Power BI Dataflow
                explanation: "A **Power BI Dataflow** is the best solution for hosting reusable, centrally managed ETL logic and data (Dimension tables) that can be consumed by multiple datasets across different workspaces."
            },
            
            // Question 29: Visualization (Custom Tooltips)
            {
                id: 29,
                topic: "Visualization / Analysis",
                level: "Advanced",
                question: "You are using a custom visual that supports additional data fields for advanced functionality. Where must you configure the usage of these fields?",
                options: [
                    "The Visualizations pane's field wells.",
                    "The Fields tab in the Modeling view.",
                    "The Format pane of the visual.",
                    "The Data View of the model."
                ]
                ,correctAnswers: [0], // Visualizations pane's field wells
                explanation: "All fields used by a visual, whether for basic display or advanced functions (like tooltips or data labels), must be assigned to the appropriate **field wells** in the Visualizations pane."
            },
            
            // Question 30: Performance Tuning (Calculated Columns)
            {
                id: 30,
                topic: "Performance Tuning / Data Modeling",
                level: "Advanced",
                question: "You have a complex query logic that runs slowly in Power Query. After identifying the non-folding step, what is the best technique to restore Query Folding for all subsequent steps?",
                options: [
                    "Convert the query to DirectQuery mode.",
                    "Use the `Value.NativeQuery()` M function immediately after the non-folding step.",
                    "Manually change the data source credentials in the Service.",
                    "Split the query into two queries: one that folds and one that processes local data."
                ],
                correctAnswers: [3],
                explanation: "The recommended technique is to **split the query** (index 3). Create a reference query after the non-folding step and then apply subsequent folding transformations to the new query, allowing Query Folding to resume."
            }
        ];
        
        // Array containing the raw text for the list items on the start screen
        const startInfoRaw = [
            '**30 questions** (5 Easy, 15 Intermediate, 10 Advanced).',
            'Practice Mode (no time limit)',
            'Questions may have **one or multiple** correct answers.',
            'Minimum passing score: **70%**'
        ];

        // --- DOM Elements ---
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const finalResultsScreen = document.getElementById('final-results-screen');
        const quizHeader = document.getElementById('quiz-header');
        const progressContainer = document.getElementById('progress-container');
        const quizFooter = document.getElementById('quiz-footer');
        
        const startInfoList = document.getElementById('start-info-list');
        const questionCounter = document.getElementById('question-counter');
        const questionText = document.getElementById('question-text');
        const optionsList = document.getElementById('options-list');
        const feedbackMessage = document.getElementById('feedback-message');
        const progressBar = document.getElementById('progress-bar');
        const pagerContainer = document.getElementById('pager-container');
        const nextBtn = document.getElementById('next-btn');
        const prevBtn = document.getElementById('prev-btn');
        const finishBtn = document.getElementById('finish-btn');
        const flagIcon = document.getElementById('flag-icon');

        // NEW ELEMENT IDs
        const reviewContainer = document.getElementById('review-container');
        const reviewToggleButton = document.getElementById('review-toggle-btn');
        const reviewList = document.getElementById('review-list');


        // --- INITIAL RENDER FIX ---
        function renderStartInfo() {
            startInfoList.innerHTML = '';
            startInfoRaw.forEach(itemText => {
                const item = document.createElement('li');
                item.innerHTML = '<i class="fas fa-check-circle"></i> ' + markdownToHtmlBold(itemText);
                startInfoList.appendChild(item);
            });
        }
        
        renderStartInfo();


        // --- EVENT LISTENERS ---
        document.getElementById('start-btn').addEventListener('click', startExam);
        nextBtn.addEventListener('click', () => navigateQuestion(1));
        prevBtn.addEventListener('click', () => navigateQuestion(-1));
        finishBtn.addEventListener('click', showFinalResults);
        flagIcon.addEventListener('click', toggleFlag);
        
        reviewToggleButton.addEventListener('click', toggleReviewVisibility);


        // --- MAIN FUNCTIONS ---
        
        function toggleReviewVisibility() {
            if (reviewContainer.style.display === 'none' || reviewContainer.style.display === '') {
                reviewContainer.style.display = 'block';
                reviewToggleButton.innerHTML = '<i class="fas fa-eye-slash"></i> Hide Answer Review';
            } else {
                reviewContainer.style.display = 'none';
                reviewToggleButton.innerHTML = '<i class="fas fa-eye"></i> Show Answer Review';
                finalResultsScreen.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }


        function startExam() {
            startScreen.style.display = 'none';
            quizScreen.style.display = 'block';
            quizHeader.style.display = 'flex';
            progressContainer.style.display = 'block';
            quizFooter.style.display = 'flex';
            
            userAnswers = quizQuestions.map(() => []);
            isFlagged = new Array(quizQuestions.length).fill(false);
            
            createPager();

            loadQuestion(0);
        }

        function loadQuestion(index) {
            currentQuestionIndex = index;
            const q = quizQuestions[index];
            
            // Check if it's a Yes/No Scenario question (No longer needed since they are converted, but good as a placeholder)
            const isYNScenario = q.level === "Yes/No Scenario";
            
            // 1. Update Header & Progress
            questionCounter.textContent = `Question ${index + 1} of ${quizQuestions.length}`;
            progressBar.style.width = `${((index + 1) / quizQuestions.length) * 100}%`;
            
            // 2. Update Question Content 
            // Since all questions are now standard, we rely only on the main question property.
            questionText.innerHTML = markdownToHtmlBold(q.question);
            
            // 3. Render Options
            optionsList.innerHTML = '';
            
            // Determine input type based on the array length
            const isMultiSelect = q.correctAnswers.length > 1;
            const inputType = isMultiSelect ? 'checkbox' : 'radio';
            
            q.options.forEach((option, i) => {
                const item = document.createElement('li');
                item.classList.add('option-item');
                
                const isChecked = userAnswers[index].includes(i);

                item.innerHTML = `
                    <label>
                        <input type="${inputType}" name="answer-option" value="${i}" ${isChecked ? 'checked' : ''} onchange="saveAnswer(${index}, ${i}, '${inputType}')">
                        ${option}
                    </label>
                `;
                optionsList.appendChild(item);
            });

            // 4. Update Navigation
            prevBtn.style.display = (index > 0) ? 'block' : 'none';
            nextBtn.style.display = (index < quizQuestions.length - 1) ? 'block' : 'none';
            finishBtn.style.display = (index === quizQuestions.length - 1) ? 'block' : 'none';
            
            // 5. Update Pager State
            updatePager();
            
            // 6. Update Flag
            updateFlagIcon(index);

            // 7. Clear Feedback
            feedbackMessage.style.display = 'none'; 
        }

        function createPager() {
            pagerContainer.innerHTML = '';
            for (let i = 0; i < quizQuestions.length; i++) {
                const item = document.createElement('div');
                item.classList.add('pager-item');
                item.textContent = i + 1;
                item.dataset.index = i;
                item.addEventListener('click', () => loadQuestion(i));
                pagerContainer.appendChild(item);
            }
        }

        function updatePager() {
            const pagerItems = document.querySelectorAll('.pager-item');
            pagerItems.forEach((item, i) => {
                item.classList.remove('active', 'answered', 'flagged');
                if (i === currentQuestionIndex) {
                    item.classList.add('active');
                }
                if (userAnswers[i].length > 0) {
                    item.classList.add('answered');
                }
                if (isFlagged[i]) {
                    item.style.backgroundColor = '#ffc107'; // Yellow for flagged
                } else if (item.classList.contains('active')) {
                    item.style.backgroundColor = '#0078d4';
                } else if (item.classList.contains('answered')) {
                    item.style.backgroundColor = '#d1e7dd';
                } else {
                    item.style.backgroundColor = '#e0e0e0';
                }
            });
        }

        function saveAnswer(qIndex, optionIndex, inputType) {
            let answers = userAnswers[qIndex];
            
            if (inputType === 'radio') {
                userAnswers[qIndex] = [optionIndex];
            } else if (inputType === 'checkbox') {
                const indexInArray = answers.indexOf(optionIndex);
                if (indexInArray > -1) {
                    answers.splice(indexInArray, 1);
                } else {
                    answers.push(optionIndex);
                }
                userAnswers[qIndex] = answers;
            }
            
            updatePager();
        }

        function navigateQuestion(direction) {
            const newIndex = currentQuestionIndex + direction;
            if (newIndex >= 0 && newIndex < quizQuestions.length) {
                loadQuestion(newIndex);
            }
        }
        
        function toggleFlag() {
            isFlagged[currentQuestionIndex] = !isFlagged[currentQuestionIndex];
            updateFlagIcon(currentQuestionIndex);
            updatePager();
        }

        function updateFlagIcon(index) {
            if (isFlagged[index]) {
                flagIcon.style.color = '#ffc107';
                flagIcon.title = "Unflag for Review";
            } else {
                flagIcon.style.color = '#6c757d';
                flagIcon.title = "Flag for Review";
            }
        }


        function showFinalResults() {
            quizScreen.style.display = 'none';
            quizHeader.style.display = 'none';
            progressContainer.style.display = 'none';
            quizFooter.style.display = 'none';
            finalResultsScreen.style.display = 'block';

            reviewContainer.style.display = 'none';
            reviewToggleButton.innerHTML = '<i class="fas fa-eye"></i> Show Answer Review';
            
            let correctCount = 0;
            const totalQuestions = quizQuestions.length; 
            reviewList.innerHTML = '';

            // 1. Calculate Score
            quizQuestions.forEach((q, i) => { // This loop runs 30 times
                // FIX: Removed try/catch, relying on stable data to avoid runtime crash.
                const userSelection = userAnswers[i].sort((a, b) => a - b);
                const correctSelection = q.correctAnswers.sort((a, b) => a - b);

                const isCorrect = userSelection.length === correctSelection.length && 
                                  userSelection.every((val, index) => val === correctSelection[index]);

                if (isCorrect) {
                    correctCount++;
                }

                // 2. Generate Review Item
                const reviewItem = document.createElement('div');
                reviewItem.classList.add('result-review-item');
                reviewItem.classList.add(isCorrect ? 'correct-answer' : 'incorrect-answer');

                const statusIconHtml = isCorrect 
                    ? '<i class="fas fa-check-circle review-status-icon correct"></i>'
                    : '<i class="fas fa-times-circle review-status-icon incorrect"></i>';
                
                // Since all are now standard MCQs, the review text is simple:
                const reviewQuestionText = markdownToHtmlBold(q.question);
                
                const userAnswerText = userSelection.length > 0 
                    ? userSelection.map(idx => `<strong>${q.options[idx]}</strong>`).join(' | ')
                    : '<em>Not Answered</em>';
                
                const correctAnswerText = correctSelection.map(idx => `<strong>${q.options[idx]}</strong>`).join(' | ');

                reviewItem.innerHTML = `
                    ${statusIconHtml}
                    <div class="review-q-text">Question ${i + 1} (${q.level}): ${reviewQuestionText}</div>
                    <p>
                        <strong>Your Answer:</strong> ${userAnswerText}
                        ${!isCorrect ? '<br><strong>Correct Answer:</strong> ' + correctAnswerText : ''}
                    </p>
                    <div class="review-explanation">
                        <strong>Explanation:</strong> ${markdownToHtmlBold(q.explanation)}
                    </div>
                `;
                reviewList.appendChild(reviewItem);
            });

            // 3. Display Final Score (using dynamic totalQuestions)
            const finalScorePercentage = Math.round((correctCount / totalQuestions) * 100);
            const isApproved = finalScorePercentage >= 70;

            document.getElementById('pass-fail-status').textContent = isApproved ? 'Passed' : 'Not Passed';
            document.getElementById('pass-fail-status').style.color = isApproved ? '#107c10' : '#dc3545';
            
            document.getElementById('final-score-text').textContent = `Final Score: ${finalScorePercentage}%`;
            document.getElementById('correct-count').textContent = correctCount;
            document.getElementById('incorrect-count').textContent = totalQuestions - correctCount;
            document.getElementById('total-count').textContent = totalQuestions;

            document.querySelector('.score-box.correct h3').parentElement.classList.toggle('correct', correctCount > 0);
            document.querySelector('.score-box.incorrect h3').parentElement.classList.toggle('incorrect', totalQuestions - correctCount > 0);
        }

    </script>

</body>
</html>
